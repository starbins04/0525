<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë§ˆë‹ˆë§ˆë‹ˆ</title>

    <!-- FullCalendar CDN -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rrule@2.6.8/dist/es5/rrule.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/rrule@6.1.8/index.global.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f2f8fc;
        }

        #calendar {
            max-width: 900px;
            margin: 0 auto;
            background-color: #fff; /* ë‹¬ë ¥ì€ í°ìƒ‰ ìœ ì§€ */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

    </style>

</head>
<body>
<div style="max-width: 900px; margin: 0 auto;">
    <div id="wageDisplay" style="text-align: right; margin-bottom: 10px; font-weight: bold;">
        ğŸ’¸ ì´ë²ˆ ë‹¬ ì›”ê¸‰: ê³„ì‚° ì¤‘...
    </div>
    <div id="calendar"></div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const calendarEl = document.getElementById('calendar');
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            events: '/events',

            // ìƒˆ ê·¼ë¬´ ë“±ë¡í•˜ê¸° ìœ„ì¹˜ ì§€ì •
            customButtons: {
                newWork: {
                    text: 'ìƒˆ ê·¼ë¬´ ë“±ë¡í•˜ê¸°',
                    click: function () {
                        window.location.href = '/calendar/new';
                    }
                }
            },

            // íˆ´ë°”ì— ë²„íŠ¼ ë°°ì¹˜
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'newWork'
            },

            // ì›”ê¸‰ ê³„ì‚° API í˜¸ì¶œ
            datesSet: function(info) {
                const start = info.start.toISOString().split("T")[0];
                const end = info.end.toISOString().split("T")[0];

                fetch(`/calendar/wage?start=${start}&end=${end}`)
                        .then(response => {
                            if (!response.ok) throw new Error("ì„œë²„ ì˜¤ë¥˜");
                            return response.json();
                        })
                        .then(data => {
                            const display = document.getElementById('wageDisplay');
                            if (data.totalWage !== undefined) {
                                display.innerText = `ğŸ’¸ ì´ë²ˆ ë‹¬ ì›”ê¸‰: ${data.totalWage.toLocaleString()}ì›`;
                            } else {
                                display.innerText = `ğŸ’¸ ì›”ê¸‰ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
                            }
                        })
                        .catch(error => {
                            console.error("ì›”ê¸‰ ê³„ì‚° ì˜¤ë¥˜:", error);
                            const display = document.getElementById('wageDisplay');
                            display.innerText = `ğŸ’¸ ì›”ê¸‰ ê³„ì‚° ì¤‘ ì˜¤ë¥˜ ë°œìƒ`;
                        });
            },

            // ë‚ ì§œ í´ë¦­ ì‹œ í˜ì´ì§€ ì´ë™
            dateClick: function(info) {
                const clickedDate = info.dateStr;
                window.location.href = `/calendar/${clickedDate}`;
            },

            // ì£¼ë§ ìƒ‰ìƒ ì„¤ì •
            dayCellDidMount: function(info) {
                const day = info.date.getDay();
                if (day === 0) {
                    info.el.style.color = 'red';
                } else if (day === 6) {
                    info.el.style.color = 'blue';
                }
            }
        });

        calendar.render();
    });
</script>
</body>
</html>